<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitors creatives</title>
    <script>
        async function loadData() {
            try {
                const response = await fetch(`data/data.csv?nocache=${new Date().getTime()}`);
                const text = await response.text();
                
                if (!text.trim()) {
                    console.error("CSV файл пуст");
                    return;
                }
                
                const rows = text.split('\n').map(row => {
                    return row.match(/(?:"([^"]+)")|([^,]+)/g)?.map(cell => cell.replace(/^"|"$/g, '')) || [];
                }).filter(row => row.length > 1);
                
                if (rows.length < 2) {
                    console.error("CSV содержит только заголовки или пустые строки");
                    return;
                }
                
                const allColumns = rows[0];
                const mainColumns = ['country', 'advertiser', 'type', 'url'];
                const detailColumns = ['audio', 'audio_translated', 'text', 'text_translated'];
                
                const container = document.getElementById('container');
                
                for (let index = 1; index < rows.length; index++) {
                    const row = rows[index];
                    if (!row[allColumns.indexOf('country')]) continue;
                    
                    const detailsDiv = document.createElement('div');
                    detailsDiv.classList.add('creative-block');
                    detailsDiv.id = `details-${index}`;
                    
                    let detailsHtml = '';
                    const htmlIndex = allColumns.indexOf('html code');
                    if (htmlIndex !== -1 && row[htmlIndex]) {
                        const htmlFile = row[htmlIndex].trim();
                        try {
                            const htmlResponse = await fetch(`html/${htmlFile}`);
                            if (htmlResponse.ok) {
                                const htmlContent = await htmlResponse.text();
                                detailsHtml += `<div class='html-content'>${htmlContent}</div>`;
                            } else {
                                console.warn(`HTML файл не найден: ${htmlFile}`);
                                detailsHtml += `<div class='html-content'>Файл не найден</div>`;
                            }
                        } catch (e) {
                            console.error("Ошибка загрузки HTML", e);
                            detailsHtml += `<div class='html-content'>Ошибка загрузки файла</div>`;
                        }
                    }
                    
                    const quantityIndex = allColumns.indexOf('quantity');
                    const variationIndex = allColumns.indexOf('variation');
                    if (quantityIndex !== -1 && variationIndex !== -1) {
                        const quantity = row[quantityIndex] || 'N/A';
                        const variation = row[variationIndex] || 'N/A';
                        detailsHtml += `<div class='variation'>#${variation} out of ${quantity}</div>`;
                    }
                    
                    detailsHtml += '<table class="details-table">';
                    detailColumns.forEach(col => {
                        const colIndex = allColumns.indexOf(col);
                        if (colIndex !== -1) {
                            detailsHtml += `<tr><th>${col}</th><td>${row[colIndex] || ''}</td></tr>`;
                        }
                    });
                    detailsHtml += '</table>';
                    detailsDiv.innerHTML = detailsHtml;
                    
                    container.appendChild(detailsDiv);
                }
            } catch (error) {
                console.error("Ошибка загрузки CSV", error);
            }
        }
        window.onload = loadData;
    </script>
    <style>
        html, body {margin: 0; padding: 0; width: 100%; background: #f5f5f5;}
        @media (max-width: 500px) {html, body {height: 100%;}}
        body {display: flex; flex-direction: column; font-family: 'Google Sans', 'Roboto', sans-serif; font-size: 14px; line-height: 20px; min-width: 360px; overflow-x: hidden; align-items: center; padding: 10px;}
        .creative-block {width: 100%; max-width: 600px; margin-bottom: 20px; padding: 10px; border: 1px solid #ddd; background: white; border-radius: 8px; box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);}
        .details-table {width: 100%; border-collapse: collapse; margin-top: 10px;}
        .details-table th, .details-table td {padding: 6px; border: 1px solid gray; text-align: left; background: #fff;}
        .html-content {background: #eee; padding: 10px; margin-bottom: 10px; border-radius: 4px;}
        .variation {font-weight: bold; margin-bottom: 10px; text-align: center; font-size: 16px; color: #333;}
    </style>
</head>
<body>
    <div id="container"></div>
</body>
</html>
