<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Креативы</title>
    <script>
        async function loadData() {
            try {
                const response = await fetch(`Data/data.csv?nocache=${new Date().getTime()}`);
                const text = await response.text();
                
                if (!text.trim()) {
                    console.error("CSV файл пуст");
                    return;
                }
                
                const rows = text.split('\n').map(row => {
                    return row.match(/(?:"([^"]+)")|([^,]+)/g)?.map(cell => cell.replace(/^"|"$/g, '')) || [];
                }).filter(row => row.length > 1);
                
                if (rows.length < 2) {
                    console.error("CSV содержит только заголовки или пустые строки");
                    return;
                }
                
                const allColumns = rows[0];
                const mainColumns = ['country', 'advertiser', 'type', 'url'];
                const detailColumns = ['audio', 'audio_translated', 'text', 'text_translated'];
                
                const container = document.getElementById('container');
                
                rows.slice(1).forEach((row, index) => {
                    if (!row[allColumns.indexOf('country')]) return;
                    
                    const detailsDiv = document.createElement('div');
                    detailsDiv.classList.add('creative-block');
                    detailsDiv.id = `details-${index}`;
                    
                    const htmlIndex = allColumns.indexOf('html code');
                    if (htmlIndex !== -1 && row[htmlIndex]) {
                        const htmlFile = row[htmlIndex].trim();
                        fetch(`html/${htmlFile}`).then(response => response.ok ? response.text() : "Файл не найден").then(htmlContent => {
                            detailsDiv.innerHTML = `<div class='html-content'>${htmlContent}</div>`;
                        });
                    }
                    
                    const quantityIndex = allColumns.indexOf('quantity');
                    const variationIndex = allColumns.indexOf('variation');
                    if (quantityIndex !== -1 && variationIndex !== -1) {
                        const quantity = row[quantityIndex] || 'N/A';
                        const variation = row[variationIndex] || 'N/A';
                        detailsDiv.innerHTML += `<div class='variation'>#${variation} out of ${quantity}</div>`;
                    }
                    
                    let detailsHtml = '<table class="details-table">';
                    detailColumns.forEach(col => {
                        const colIndex = allColumns.indexOf(col);
                        if (colIndex !== -1) {
                            detailsHtml += `<tr><th>${col}</th><td>${row[colIndex] || ''}</td></tr>`;
                        }
                    });
                    detailsHtml += '</table>';
                    detailsDiv.innerHTML += detailsHtml;
                    
                    container.appendChild(detailsDiv);
                });
            } catch (error) {
                console.error("Ошибка загрузки CSV", error);
            }
        }
        window.onload = loadData;
    </script>
    <style>
        html, body {margin: 0; padding: 0; width: 100%;}
        @media (max-width: 500px) {html, body {height: 100%;}}
        body {display: flex; flex-direction: column; font-family: 'Google Sans', 'Roboto', sans-serif; font-size: 14px; line-height: 20px; min-width: 360px; overflow-x: hidden;}
        body > div[ng-app] {min-height: 100%; position: relative; box-sizing: border-box; overflow-x: hidden; top: -64px; padding-top: 64px;}
        .creative-block {margin-bottom: 20px; padding: 10px; border: 1px solid #ddd; background: #f9f9f9;}
        .details-table {width: 100%; border-collapse: collapse;}
        .details-table th, .details-table td {padding: 6px; border: 1px solid gray; text-align: left;}
        .html-content {background: #eee; padding: 10px; margin-bottom: 10px;}
        .variation {font-weight: bold; margin-bottom: 10px;}
    </style>
</head>
<body>
    <div id="container"></div>
</body>
</html>
