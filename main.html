<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Список Креативов</title>
    <script>
        async function loadData() {
            const response = await fetch('data/data.csv');
            const text = await response.text();
            const rows = text.split('\n').map(row => row.split('\t'));

            const table = document.getElementById('dataTable');
            const headerRow = document.createElement('tr');

            rows[0].forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                headerRow.appendChild(th);
            });

            table.appendChild(headerRow);

            rows.slice(1).forEach(row => {
                if (row.length < 2) return; // Пропускаем пустые строки

                const tr = document.createElement('tr');
                tr.classList.add('clickable-row');
                row.forEach((cell, index) => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });

                const detailsRow = document.createElement('tr');
                detailsRow.classList.add('details-row');
                detailsRow.style.display = 'none';

                const detailsCell = document.createElement('td');
                detailsCell.setAttribute('colspan', rows[0].length);
                detailsCell.innerHTML = `<div class="details-content" id="details-${row[0]}"></div>`;
                detailsRow.appendChild(detailsCell);

                table.appendChild(tr);
                table.appendChild(detailsRow);

                tr.addEventListener('click', () => toggleDetails(row[0], detailsRow));
            });
        }

        async function toggleDetails(id, row) {
            if (row.style.display === 'none') {
                row.style.display = 'table-row';
                await loadCreativeDetails(id);
            } else {
                row.style.display = 'none';
            }
        }

        async function loadCreativeDetails(id) {
            const detailsContainer = document.getElementById(`details-${id}`);
            if (!detailsContainer) return;

            // Загружаем данные
            const response = await fetch('Data/data.tsv');
            const text = await response.text();
            const rows = text.split('\n').map(row => row.split('\t'));
            const header = rows[0];
            const dataRow = rows.find(row => row[0] === id);

            if (!dataRow) {
                detailsContainer.innerHTML = `<p>Ошибка: данные не найдены.</p>`;
                return;
            }

            let detailsHtml = `<h3>Креатив ${id}</h3>`;

            // Выводим ключевые поля
            detailsHtml += `<table class="details-table">`;
            header.forEach((col, index) => {
                detailsHtml += `<tr><th>${col}</th><td>${dataRow[index]}</td></tr>`;
            });
            detailsHtml += `</table>`;

            // Загружаем HTML-код (если файл существует)
            try {
                const htmlResponse = await fetch(`html/${id}.txt`);
                if (htmlResponse.ok) {
                    const htmlText = await htmlResponse.text();
                    detailsHtml += `<h4>HTML-код:</h4><div class="html-content">${htmlText}</div>`;
                }
            } catch {}

            // Проверяем и загружаем видео (если есть)
            const videoPath = `videos/${id}.mp4`;
            fetch(videoPath).then(res => {
                if (res.ok) {
                    detailsHtml += `
                        <h4>Видео:</h4>
                        <video controls>
                            <source src="${videoPath}" type="video/mp4">
                            Ваш браузер не поддерживает видео.
                        </video>
                    `;
                }
                detailsContainer.innerHTML = detailsHtml;
            });
        }

        window.onload = loadData;
    </script>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; border: 1px solid black; text-align: left; }
        .clickable-row:hover { background-color: #f1f1f1; cursor: pointer; }
        .details-row { background-color: #f9f9f9; }
        .details-table th, .details-table td { padding: 6px; border: 1px solid gray; }
        .html-content { background: #eee; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Список Креативов</h1>
    <table id="dataTable"></table>
</body>
</html>
